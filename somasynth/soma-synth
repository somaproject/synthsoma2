#!/usr/bin/env python
import os
from optparse import OptionParser
from soma import pysynthsoma2
import time
import tempfile

if __name__ == "__main__":


    parser = OptionParser()
    parser.add_option("-i", "--ip", dest="ip",
                      help="ip address to send soma data to", default="127.0.0.1")
    
    parser.add_option("-d", "--domain", dest="use_domain",
                      action="store_true", default=False, 
                      help="use unix domain sockets in temp dir")

    
    (options, args) = parser.parse_args()
    if options.use_domain:
        tempdir = tempfile.mkdtemp()
        print "The domain root dir is ", tempdir
        e, d = pysynthsoma2.default.domain(tempdir)
    else:
        e, d = pysynthsoma2.default.ip(options.ip)
    runner = pysynthsoma2.default.create_default(e, d, 2, 0)
    

    runner.run()
    while(True) :
        time.sleep(1)
        s = runner.getStats()
        print s.eventcycles, s.eventcyclerate, s.datapackets, s.datapacketrate
    
    runner.shutdown()
    s = runner.getStats()

